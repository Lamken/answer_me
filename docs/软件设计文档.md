## 软件设计文档

##### 小组成员：林景华、林昆、廖崇翔

此文档介绍 crypto(加密算法库) 项目的架构设计及技术实现：

- [技术选型以及理由](#1技术选型以及理由)
- [架构设计](#2架构设计)
- [模块划分](#3模块划分)
- [设计模式](#4设计模式)


#### 1、技术选型以及理由
在原生c++语言库的基础上，根据sha1、sha2、base64 和 md5 四种经典的加密算法进行基本加密算法库函数开发。

 - 为什么选择 c++ 语言
    1. 抽象程度更高的语言的原生库已自带基本加密算法实现，如java、go、python等。但 c++ 的原生库并没有支持
    2. 底层的 c 语言已经有了著名的 openssl 库实现。
    3. c++ 是在性能及便利性中做折衷。
 - 为什么选择 sha、md5 等加密算法
    - sha1等常用加密算法：作为比较经典的加密算法，逐个实现加密步骤中需要完成的计算，能够为其他加密算法的开发和实现提供更为普适性的支持。
    - 算法描述完善清晰，容易测试验证。


#### 2、架构设计

由于是库函数提供，主要考虑的是使用的便利性，而仅仅头文件引用无疑是最方便的。也方便快速使用。因此利用了大量 c++ 的新特性来保证头文件的引用正确。

* include：核心算法过程实现
* test：测试保证加密算法的正确性
* examples：使用样例，入门教程
* googletest：第三方测试工具


#### 3、模块划分

根据需要实现的四类加密算法(五种不同过程)，对库函数划分为5个模块：
 - [Base64](https://en.wikipedia.org/wiki/Base64)
 - [MD5](https://en.wikipedia.org/wiki/MD5)
 - [SHA-1](https://en.wikipedia.org/wiki/SHA-1)
 - [SHA-256](https://en.wikipedia.org/wiki/SHA-2)
 - [SHA-512](https://en.wikipedia.org/wiki/SHA-2)



最后，综合考虑使用的语言，我们可以完善得到详细的项目结构如下所示。后续的开发可以明确地进行分工，每个人负责不同的工作，然后针对各个算法里面的主要功能进行开发即可，如设计，编码，测试等。开发完算法函数之后，再进行集成测试。
```txt
.
├── CMakeLists.txt                              # 总集项目
├── Doxyfile                                    # 代码文档生成文件 : doxygen
├── README.md                                   # 项目自述
├── examples                                    # 加密算法库函数使用例子
│   ├── CMakeLists.txt
│   ├── base64.cpp
│   ├── md5.cpp
│   ├── sha1.cpp
│   ├── sha256.cpp
│   └── sha512.cpp
├── googletest                                  # 第三方测试工具 : googletest
│   ├── CMakeLists.txt
│   ├── LICENSE
│   ├── README.md
│   ├── include                                 # googletest 头文件
│   │   └── gtest
│   └── src
│       └── ...
├── include                                     # 核心算法库
│   └── util
│       ├── base64.hpp                          # Base64 编码解码算法实现
│       ├── crypto.hpp                          # 加密算法库版本信息
│       ├── internal                            # 加密算法库内部使用的函数
│       │   ├── base64_helper.hpp
│       │   ├── md5_helper.hpp
│       │   ├── noncopyable.hpp
│       │   └── sha_helper.hpp
│       ├── md5.hpp                             # MD5 加密算法实现
│       ├── sha1.hpp                            # SHA-1 加密算法实现
│       ├── sha256.hpp                          # SHA-256 加密算法实现
│       └── sha512.hpp                          # SHA-512 加密算法实现
├── src                                         # 安装库文件
│   └── CMakeLists.txt                          # 构建安装头文件
└── tests                                       # 加密算法准确性测试
    ├── CMakeLists.txt                          # 构建测试
    ├── base64Test.cpp                          # Base64 编码解码测试
    ├── md5Test.cpp                             # MD5 加密算法测试
    ├── sha1Test.cpp                            # SHA-1 加密算法测试
    ├── sha256Test.cpp                          # SHA-256 加密算法测试
    └── sha512Test.cpp                          # SHA-512 加密算法测试
```



#### 4、设计模式
* 面向对象编程：函数库中使用了面向对象编程的封装思想，按照各种加密算法的计算过程进行屏蔽，防止第三方错误调用。例如 `sha1` 加密算法屏蔽了实现过程，提供黑箱操作。
* 单例模式：在全局上频繁被使用的变量将会设置为仅有一个实例，从而节省内存资源及加快运行速度。如 `DEC_TABLE_`， `ENC_TABLE_`等
* 简单工厂模式：加密算法计算过程更像是流水，难以分割子过程。后一过程往往牵扯前几个过程，为了方便用户使用, 就把其中最常见场景的逻辑都封装一个专门的工厂中, 即利用静态函数完成处理，免去调用者管理中间状态。其余少见场景仍然保留接口。但所有场景的处理逻辑都分成三个子过程：初始化 `init` ，更新 `update` ，及输出 `final`。
* 适配器模式：包装一种算法, 让调用者只需关注接口而不是实现。此处由于是加密算法，对速度很是看重，因此利用 c++ 模板多态进行适配。因为哈希函数都提供了 `update` 接口。

